<!DOCTYPE html>
<!--[if lt IE 7]>       <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>          <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>          <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
    <title>Implementing Apple Watch Sensor Communication - DataFil Documentation</title>
    <meta name="description" content="Full Documentation for the DataFil Project" />
    <meta name="author" content="Alexander Gubbay">
    <meta charset="UTF-8">
    <link rel="icon" href="../themes/daux/img/favicon-blue.png" type="image/x-icon">
    <!-- Mobile -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Font -->
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700&subset=latin,cyrillic-ext,cyrillic' rel='stylesheet' type='text/css'>
    <!-- CSS -->
    <link href='../themes/daux/css/theme-blue.min.css' rel='stylesheet' type='text/css'>
            <!-- Tipue Search -->
        <link href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body class="">
    
<header class="Navbar hidden-print">
    <a class="Navbar__brand" href="../index.html">DataFil Documentation</a>

    <div class="Search">
        <svg class="Search__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451 451"><path d="M447.05 428l-109.6-109.6c29.4-33.8 47.2-77.9 47.2-126.1C384.65 86.2 298.35 0 192.35 0 86.25 0 .05 86.3.05 192.3s86.3 192.3 192.3 192.3c48.2 0 92.3-17.8 126.1-47.2L428.05 447c2.6 2.6 6.1 4 9.5 4s6.9-1.3 9.5-4c5.2-5.2 5.2-13.8 0-19zM26.95 192.3c0-91.2 74.2-165.3 165.3-165.3 91.2 0 165.3 74.2 165.3 165.3s-74.1 165.4-165.3 165.4c-91.1 0-165.3-74.2-165.3-165.4z"/></svg>
        <input type="search" id="tipue_search_input" class="Search__field" placeholder="Search..." autocomplete="on" results=25 autosave=text_search>
    </div>
</header>
<div class="Columns content">
    <aside class="Columns__left Collapsible">
        <div class="Collapsible__container">
            <button type="button" class="Button Collapsible__trigger">
                <span class="Collapsible__trigger--bar"></span>
                <span class="Collapsible__trigger--bar"></span>
                <span class="Collapsible__trigger--bar"></span>
            </button>
        </div>

        <div class="Collapsible__content">
            <!-- Navigation -->
            <ul class='Nav'><li class='Nav__item '><a href="../index.html">DataFil Documentation</a></li><li class='Nav__item  has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>Showcase App</a><ul class='Nav'><li class='Nav__item '><a href="../Showcase_App/How_to_Use_the_Showcase_App.html">How to Use the Showcase App</a></li><li class='Nav__item '><a href="../Showcase_App/Using_an_Apple_Watch_with_the_Showcase_App.html">Using an Apple Watch with the Showcase App</a></li></ul></li><li class='Nav__item Nav__item--open has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>Sensor Data Flow Management Tools</a><ul class='Nav'><li class='Nav__item Nav__item--active'><a href="../Sensor_Data_Flow_Management_Tools/Implementing_Apple_Watch_Sensor_Communication.html">Implementing Apple Watch Sensor Communication</a></li><li class='Nav__item '><a href="../Sensor_Data_Flow_Management_Tools/Using_the_Data_Source_Manager.html">Using the Data Source Manager</a></li><li class='Nav__item '><a href="../Sensor_Data_Flow_Management_Tools/Using_the_Filter_Manager.html">Using the Filter Manager</a></li></ul></li><li class='Nav__item  has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>Filter Algorithm Implementation</a><ul class='Nav'><li class='Nav__item '><a href="../Filter_Algorithm_Implementation/accelPoint_Data_Object.html">accelPoint Data Object</a></li><li class='Nav__item '><a href="../Filter_Algorithm_Implementation/Filter_Implementation.html">Filter Implementation</a></li><li class='Nav__item '><a href="../Filter_Algorithm_Implementation/Filter_Protocol.html">Filter Protocol</a></li></ul></li><li class='Nav__item  has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>Algorithm Specifications</a><ul class='Nav'><li class='Nav__item '><a href="../Algorithm_Specifications/Bounded_Average_Filter.html">Bounded Average Filter</a></li><li class='Nav__item '><a href="../Algorithm_Specifications/High_Pass_Filter.html">High Pass Filter</a></li><li class='Nav__item '><a href="../Algorithm_Specifications/Low_Pass_Filter.html">Low Pass Filter</a></li><li class='Nav__item '><a href="../Algorithm_Specifications/Savitzky_Golay_Filter.html">Savitzky Golay Filter</a></li><li class='Nav__item '><a href="../Algorithm_Specifications/Total_Variation_Denoising_Filter.html">Total Variation Denoising Filter</a></li></ul></li><li class='Nav__item '><a href="../Library_Organisation.html">Library Organisation</a></li><li class='Nav__item '><a href="../Contents.html">Contents</a></li></ul>

            <div class="Links">
                
                                    <div class="CodeToggler">
                        <hr/>
                                                    <a class="CodeToggler__button CodeToggler__button--main" href="#">Show Code Blocks Inline</a><br>
                                            </div>
                
                            </div>
        </div>
    </aside>
    <div class="Columns__right ">
        <div class="Columns__right__content">
            <div class="doc_content">
                <article class="Page">

    <div class="Page__header">
        <h1><a href="../Sensor_Data_Flow_Management_Tools/Implementing_Apple_Watch_Sensor_Communication.html">Sensor Data Flow Management Tools</a> <svg class="Page__header--separator" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 477.175 477.175"><path d="M360.73 229.075l-225.1-225.1c-5.3-5.3-13.8-5.3-19.1 0s-5.3 13.8 0 19.1l215.5 215.5-215.5 215.5c-5.3 5.3-5.3 13.8 0 19.1 2.6 2.6 6.1 4 9.5 4 3.4 0 6.9-1.3 9.5-4l225.1-225.1c5.3-5.2 5.3-13.8.1-19z"/></svg> <a href="../Sensor_Data_Flow_Management_Tools/Implementing_Apple_Watch_Sensor_Communication.html">Implementing Apple Watch Sensor Communication</a></h1>
                    </div>


    <div class="s-content">
        <p>The communication of data to and from the Apple Watch is handled using the following classes, found in the globalModel group:</p>
<ul>
<li>
<code>RemoteDataInterface</code>
</li>
<li>
<code>Serialiser</code>
</li>
<li>
<code>RemoteCommunicator</code>
</li>
</ul>
<p>The stack is symmetrical, meaning that the same code can be used to start a session from both devices. In the following sections, each class in the stack is described.</p>
<h1 id="page_Remote+Communicator">Remote Communicator</h1>
<p>The <code>RemoteCommunicator</code> class is the lowest level in this process, used to manage the communication session with the remote device, and is independent of any other part of the application, meaning it can be used to send any arbitrary message to and from the watch. Messages are sent as a key value pair, and observers can subscribe to be notified when a message with a matching key arrives. This allows messages of different types to be sent and received to specific parts of the application without the need to determine if a specific message is relevant in the main logic of the application. Each observing communicator can assume that if it is notified of a message that it was intended for them.</p>
<p>The class is instantiated with a <code>deviceId</code>, for debugging purposes, allowing the source devices of console messages to be traced. It also contains several methods for checking if the remote partner is connected and reachable.</p>
<h2 id="page_Function+Summary">Function Summary</h2>
<h3 id="page_Start">Start</h3>
<p><code>func start(deviceId: String)</code></p>
<p>Attempts to start a session with the remote device. Should this not be possible an error message will be printed to the console. This method must be called before attempting communication.</p>
<h3 id="page_isSupported">isSupported</h3>
<p><code>func isSupported() -&gt; Bool</code></p>
<p>Returns a Boolean detailing if Apple Watch communication is supported by the device.</p>
<h3 id="page_watchIsConnected">watchIsConnected</h3>
<p><code>func watchIsConnected() -&gt; Bool</code></p>
<p>Returns a Boolean detailing if an Apple Watch is connected and can be reached for communication.</p>
<h3 id="page_sendMessage">sendMessage</h3>
<p><code>func sendMessage(key: String, value: Any)</code></p>
<p>Attempts to send a message with key and value passed into the function to the remote device. If this fails, a message will be printed to the console. On the remote device, any observer subscribed to messages with the matching key will be notified of the contents.</p>
<h3 id="page_addObserver">addObserver</h3>
<p><code>func addObserver(key: String, update: @escaping (Any) -&gt; Void)</code></p>
<p>Adds a callback from an observing class that will be called when a message with a matching key arrives from the remote device. It must accept any object as this is what can be passed into the <code>sendMessage</code> function on the remote partner.</p>
<h1 id="page_Remote+Data+Interface">Remote Data Interface</h1>
<p>Next in the stack is the logic specific to sending and receiving sensor data. This is the responsibility of the <code>remoteDataInterface</code>. It can be used to send outgoing sensor data to the remote partner, by observing for new local data though the same observer system used for all consumers. The <code>remoteDataInterface</code> can observe to the <code>remoteCommunicator</code> class to listen for new incoming remote data, which will arrive under a specific key. When listening, it will notify other consumers of sensor data using the same notification format as local sensor data notifications, meaning that any consumer of local data can be trivially switched to listen for remote data. This symmetry of the communication hierarchy and uniform processing of remote and local data means that if desired, the watch could listen for sensor data from the iPhone, or even another watch. There is no pre-defined rigid data flow.</p>
<p>Note that remoteDataInterface is a singleton.</p>
<h2 id="page_Function+Summary">Function Summary</h2>
<h3 id="page_publishOutgoingData">publishOutgoingData</h3>
<p><code>func publishOutgoingData()</code></p>
<p>When called the class will begin attempting to send new raw data published by the <code>dataSourceManager</code> to the remote device. Can be used to send raw data from the Apple Watch to the iPhone.</p>
<h3 id="page_subscribeIncomingData">subscribeIncomingData</h3>
<p><code>func subscribeIncomingData()</code></p>
<p>Will cause the device to start listening to messages sent from the <code>publishOutgoingData</code> function on the remote device. When received, the data will be published globally under a notification named <code>newRemoteData</code>.</p>
<h1 id="page_Serialiser">Serialiser</h1>
<p>It is important to note that it is not possible simply to send <code>accelPoint</code> objects to a remote device. The communication protocol defined by Apple can only accept primitive objects such as Strings, Doubles and Integers. For this reason, the <code>remoteDataInterface</code> will serialise each <code>accelPoint</code>, using the <code>Serialiser</code> class before sending. When receiving, it will de-serialise the incoming primitive back into an <code>accelPoint</code> object before notifying consumers of this data. This process is transparent to the sender and receiver of the sensor data, and part of the hierarchical design of the communication. These functions do not need to be called directly, they are used as required by the <code>remoteDataInterface</code> for sending and receiving.</p>
<h2 id="page_Function+Summary">Function Summary</h2>
<h3 id="page_serialise">serialise</h3>
<p><code>serialise(input: accelPoint) -&gt; String</code></p>
<p>Will convert a valid <code>accelPoint</code> object into a <code>String</code> for sending. Reversed with <code>deserialise</code>.</p>
<h3 id="page_deserialise">deserialise</h3>
<p><code>deserialise(input: String) -&gt; accelPoint</code></p>
<p>Will convert a valid <code>String</code> into an <code>accelPoint</code> object. Reverse of <code>serialise</code> function.</p>
    </div>

        <nav>
        <ul class="Pager">
            <li class=Pager--prev><a href="../Showcase_App/Using_an_Apple_Watch_with_the_Showcase_App.html">Previous</a></li>            <li class=Pager--next><a href="../Sensor_Data_Flow_Management_Tools/Using_the_Data_Source_Manager.html">Next</a></li>        </ul>
    </nav>
    </article>

            </div>
        </div>
    </div>
</div>

    
    <!-- jQuery -->
    <script src="../themes/daux/js/jquery-1.11.3.min.js"></script>

    <!-- hightlight.js -->
    <script src="../themes/daux/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- JS -->
    
    <script src="../themes/daux/js/daux.js"></script>

            <!-- Tipue Search -->
        <script type="text/javascript" src="../tipuesearch/tipuesearch.js"></script>

        <script>
            window.onunload = function(){}; // force $(document).ready to be called on back/forward navigation in firefox
            $(function() {
                tipuesearch({
                    'base_url': '../'
                });
            });
        </script>
    
</body>
</html>
